"""\nCyberbullying Detection Web Interface\nFlask-based API for the detection system\n"""\n\nfrom flask import Flask, render_template, request, jsonify\nfrom cyberbullying_detector import CyberbullyingDetector\nfrom encrypted_reports import EncryptedReportsHandler\nimport logging\nfrom datetime import datetime\n\napp = Flask(__name__)\napp.config['JSON_SORT_KEYS'] = False\n\n# Initialize components\ndetector = CyberbullyingDetector()\nreports_handler = EncryptedReportsHandler()\n\n# Setup logging\nlogging.basicConfig(level=logging.INFO)\nlogger = logging.getLogger(__name__)\n\n@app.route('/', methods=['GET'])\ndef home():\n    """Render home page"""\n    return render_template('index.html')\n\n@app.route('/api/detect', methods=['POST'])\ndef detect_cyberbullying():\n    """API endpoint for cyberbullying detection"""\n    try:\n        data = request.get_json()\n        text = data.get('text', '')\n        \n        if not text:\n            return jsonify({'error': 'Text field required'}), 400\n        \n        # Perform detection\n        result = detector.detect_cyberbullying(text)\n        \n        # Log the detection\n        logger.info(f'Detection performed: {result[\"severity\"]}')\n        \n        return jsonify(result), 200\n    except Exception as e:\n        logger.error(f'Detection error: {e}')\n        return jsonify({'error': str(e)}), 500\n\n@app.route('/api/report', methods=['POST'])\ndef submit_report():\n    """Submit an encrypted cyberbullying report"""\n    try:\n        data = request.get_json()\n        text = data.get('text', '')\n        severity = data.get('severity', 'unknown')\n        confidence = data.get('confidence', 0.0)\n        reporter_id = data.get('reporter_id', None)\n        \n        # Create encrypted report\n        encrypted_report = reports_handler.create_report(\n            text=text,\n            severity=severity,\n            confidence=confidence,\n            reporter_id=reporter_id\n        )\n        \n        # Store report\n        storage_path = reports_handler.store_report(encrypted_report)\n        \n        logger.info(f'Report submitted: {encrypted_report[\"id\"]}')\n        \n        return jsonify({\n            'success': True,\n            'report_id': encrypted_report['id'],\n            'stored_at': storage_path\n        }), 201\n    except Exception as e:\n        logger.error(f'Report submission error: {e}')\n        return jsonify({'error': str(e)}), 500\n\n@app.route('/api/report/<report_id>', methods=['GET'])\ndef retrieve_report(report_id):\n    """Retrieve and decrypt a report"""\n    try:\n        decrypted_report = reports_handler.retrieve_report(report_id)\n        \n        if not decrypted_report:\n            return jsonify({'error': 'Report not found'}), 404\n        \n        logger.info(f'Report retrieved: {report_id}')\n        \n        return jsonify({\n            'success': True,\n            'data': decrypted_report\n        }), 200\n    except Exception as e:\n        logger.error(f'Report retrieval error: {e}')\n        return jsonify({'error': str(e)}), 500\n\n@app.route('/api/batch-detect', methods=['POST'])\ndef batch_detect():\n    """Batch detection for multiple texts"""\n    try:\n        data = request.get_json()\n        texts = data.get('texts', [])\n        \n        if not texts:\n            return jsonify({'error': 'Texts array required'}), 400\n        \n        results = detector.batch_detect(texts)\n        \n        logger.info(f'Batch detection performed on {len(texts)} texts')\n        \n        return jsonify({\n            'count': len(results),\n            'results': results\n        }), 200\n    except Exception as e:\n        logger.error(f'Batch detection error: {e}')\n        return jsonify({'error': str(e)}), 500\n\n@app.route('/health', methods=['GET'])\ndef health_check():\n    """Health check endpoint"""\n    return jsonify({\n        'status': 'healthy',\n        'timestamp': datetime.now().isoformat(),\n        'service': 'Cyberbullying Detection System'\n    }), 200\n\n@app.errorhandler(404)\ndef not_found(error):\n    """Handle 404 errors"""\n    return jsonify({'error': 'Endpoint not found'}), 404\n\n@app.errorhandler(500)\ndef internal_error(error):\n    """Handle 500 errors"""\n    return jsonify({'error': 'Internal server error'}), 500\n\nif __name__ == '__main__':\n    app.run(debug=True, host='0.0.0.0', port=5000)\n
